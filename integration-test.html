<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test - AuraFlow</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0a0a;
            color: #00c853;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test { margin: 10px 0; padding: 10px; border-left: 3px solid #666; }
        .pass { border-color: #00c853; color: #00c853; }
        .fail { border-color: #ff3366; color: #ff3366; }
        .pending { border-color: #ffab00; color: #ffab00; }
        h1 { color: #4c9aff; }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #333;
            margin: 20px 0;
            background: white;
        }
        pre {
            background: #1a1a1a;
            padding: 10px;
            overflow-x: auto;
            border-radius: 4px;
        }
        .error { color: #ff3366; }
        .success { color: #00c853; }
    </style>
</head>
<body>
    <h1>üß™ AuraFlow Integration Test</h1>
    <p>This test loads the actual application and monitors for errors.</p>

    <div id="test-results"></div>

    <h2>Application Preview</h2>
    <iframe id="app-frame" src="index.html"></iframe>

    <h2>Console Log</h2>
    <pre id="console-log"></pre>

    <script>
        const results = [];
        const consoleLog = [];

        function addTest(name, status, details = '') {
            results.push({ name, status, details });
            renderResults();
        }

        function renderResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = results.map(test => `
                <div class="test ${test.status}">
                    ${test.status === 'pass' ? '‚úÖ' : test.status === 'fail' ? '‚ùå' : '‚è≥'}
                    <strong>${test.name}</strong>
                    ${test.details ? `<br><span style="font-size: 0.9em;">${test.details}</span>` : ''}
                </div>
            `).join('');
        }

        function addLog(message, type = 'info') {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            consoleLog.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            const logEl = document.getElementById('console-log');
            logEl.textContent = consoleLog.join('\n');
            logEl.scrollTop = logEl.scrollHeight;
        }

        // Test 1: Check if iframe loads
        addTest('Application frame loads', 'pending');

        const frame = document.getElementById('app-frame');

        frame.onload = function() {
            addTest('Application frame loads', 'pass', 'iframe loaded successfully');
            addLog('Application iframe loaded', 'success');

            // Test 2: Check for JavaScript errors
            addTest('No JavaScript errors', 'pending');

            setTimeout(() => {
                try {
                    const frameWindow = frame.contentWindow;
                    const frameDocument = frame.contentDocument;

                    // Test 3: Check if loading screen exists
                    const loadingScreen = frameDocument.getElementById('loading-screen');
                    if (loadingScreen) {
                        addTest('Loading screen exists', 'pass');
                        addLog('Loading screen found');
                    } else {
                        addTest('Loading screen exists', 'fail', 'loading-screen element not found');
                        addLog('Loading screen not found', 'error');
                    }

                    // Test 4: Check if app div exists
                    const appDiv = frameDocument.getElementById('app');
                    if (appDiv) {
                        addTest('App container exists', 'pass');
                        addLog('App container found');
                    } else {
                        addTest('App container exists', 'fail', 'app element not found');
                        addLog('App container not found', 'error');
                    }

                    // Test 5: Check if balance display exists
                    setTimeout(() => {
                        const balanceDisplay = frameDocument.getElementById('balance-display');
                        if (balanceDisplay) {
                            addTest('Balance display rendered', 'pass', `Content: ${balanceDisplay.textContent}`);
                            addLog(`Balance display: ${balanceDisplay.textContent}`, 'success');
                        } else {
                            addTest('Balance display rendered', 'fail', 'balance-display not found');
                            addLog('Balance display not found', 'error');
                        }

                        // Test 6: Check if dashboard is visible
                        const dashboard = frameDocument.getElementById('dashboard');
                        if (dashboard && dashboard.classList.contains('active')) {
                            addTest('Dashboard tab active', 'pass');
                            addLog('Dashboard is active tab', 'success');
                        } else {
                            addTest('Dashboard tab active', 'fail', 'Dashboard not active');
                            addLog('Dashboard not active', 'error');
                        }

                        // Test 7: Check if events are loaded
                        const eventCards = frameDocument.querySelectorAll('.event-card');
                        if (eventCards.length > 0) {
                            addTest('Events loaded', 'pass', `Found ${eventCards.length} events`);
                            addLog(`${eventCards.length} events loaded`, 'success');
                        } else {
                            addTest('Events loaded', 'fail', 'No event cards found');
                            addLog('No events found', 'error');
                        }

                        // Test 8: Check if timer tab works
                        const timerTab = frameDocument.querySelector('[data-tab="timer"]');
                        if (timerTab) {
                            addTest('Timer tab exists', 'pass');
                            addLog('Timer tab button found', 'success');
                        } else {
                            addTest('Timer tab exists', 'fail');
                            addLog('Timer tab not found', 'error');
                        }

                        // Test 9: Check if history tab exists
                        const historyTab = frameDocument.querySelector('[data-tab="history"]');
                        if (historyTab) {
                            addTest('History tab exists', 'pass');
                            addLog('History tab button found', 'success');
                        } else {
                            addTest('History tab exists', 'fail');
                            addLog('History tab not found', 'error');
                        }

                        // Test 10: Check for any error elements
                        const errorScreen = frameDocument.getElementById('error-screen');
                        if (!errorScreen) {
                            addTest('No error screen shown', 'pass');
                            addLog('No error screen detected', 'success');
                        } else {
                            addTest('No error screen shown', 'fail', 'Error screen is visible');
                            addLog('Error screen detected!', 'error');
                        }

                        // Final summary
                        setTimeout(() => {
                            const passed = results.filter(r => r.status === 'pass').length;
                            const failed = results.filter(r => r.status === 'fail').length;
                            const total = results.length;

                            addLog(`\n${'='.repeat(50)}`, 'info');
                            addLog(`TEST SUMMARY: ${passed}/${total} passed, ${failed} failed`, 'info');
                            addLog(`Success Rate: ${((passed/total)*100).toFixed(0)}%`, 'info');
                            addLog(`${'='.repeat(50)}`, 'info');

                            if (failed === 0) {
                                addLog('üéâ ALL TESTS PASSED!', 'success');
                            } else {
                                addLog(`‚ö†Ô∏è ${failed} test(s) failed`, 'error');
                            }
                        }, 500);

                    }, 3000); // Wait 3 seconds for app to initialize

                } catch (e) {
                    addTest('No JavaScript errors', 'fail', e.message);
                    addLog(`JavaScript error: ${e.message}`, 'error');
                }
            }, 1000); // Wait 1 second for initial load
        };

        frame.onerror = function(error) {
            addTest('Application frame loads', 'fail', 'iframe failed to load');
            addLog(`iframe load error: ${error}`, 'error');
        };

        // Capture console errors from iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === 'console') {
                addLog(`[App] ${event.data.message}`, event.data.level);
            }
        });

        addLog('Integration test started...', 'info');
    </script>
</body>
</html>
